FROM python:3.10

LABEL maintainer="Jan Detleffsen <jan.detleffsen@mpi-bn.mpg.de>"

COPY . /tmp/

# Install Python packages \
RUN apt-get update && \
    apt-get install -y openssh-client && \
    apt-get install micromamba && \
    apt-get clean && \
    rm /tmp/Dockerfile

RUN micromamba install -y -n base -f /tmp/sctoolbox_env.yml && \
    micromamba clean --all --yes

RUN pip install /tmp/[all]

RUN rm -r /tmp/*

# Set the time zone
RUN sh -c "echo 'Europe/Berlin' > /etc/timezone" && \
    dpkg-reconfigure -f noninteractive tzdata

# Generate an ssh key
RUN mkdir .ssh && \
    ssh-keygen -t ed25519 -N "" -f .ssh/id_ed25519

ENV ROOT=TRUE \
    DISABLE_AUTH=TRUE
